<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>WebGL れすぷりんぐ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background-color: black;
        text-align: center;
      }
      #startButton {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        padding: 15px 30px;
        font-size: 20px;
        background-color: red;
        color: white;
        border: none;
        cursor: pointer;
        z-index: 100;
      }
      canvas {
        display: none;
      }
    </style>
  </head>
  <body>
    <button id="startButton">respring!</button>
    <script>
      let started = false;
      const scene = new THREE.Scene();
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      camera.position.set(0, 10, 30);
      let renderer;
      document
        .getElementById("startButton")
        .addEventListener("click", function () {
          if (started) return;
          started = true;
          this.style.display = "none";
          const colors = ["red", "yellow", "blue"];
          let index = 0;
          function a() {
            if (index < colors.length) {
              document.body.style.backgroundColor = colors[index++];
              setTimeout(a, 800);
            } else {
              initWebGL();
            }
          }
          a();
        });
      function initWebGL() {
        renderer = new THREE.WebGLRenderer({
          antialias: true,
          logarithmicDepthBuffer: true,
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);
        renderer.domElement.style.display = "block";
        const ground = new THREE.Mesh(
          new THREE.PlaneGeometry(100, 100),
          new THREE.ShadowMaterial({ opacity: 0.5 })
        );
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(10, 20, 10);
        light.castShadow = true;
        light.shadow.mapSize.width = 2048;
        light.shadow.mapSize.height = 2048;
        scene.add(light);
        const ambientLight = new THREE.AmbientLight(0x404040);
        scene.add(ambientLight);
        const objects = [];
        const sphereGeo = new THREE.SphereGeometry(1, 32, 32);
        const torusGeo = new THREE.TorusKnotGeometry(1, 0.3, 64, 16);
        const material = new THREE.MeshStandardMaterial({
          color: 0xff0000,
          roughness: 0.7,
          metalness: 0.3,
        });
        for (let i = 0; i < 500; i++) {
          const mesh = new THREE.Mesh(
            i % 2 === 0 ? sphereGeo : torusGeo,
            material.clone()
          );
          mesh.position.set(
            Math.random() * 40 - 20,
            Math.random() * 10,
            Math.random() * 40 - 20
          );
          mesh.castShadow = true;
          scene.add(mesh);
          objects.push(mesh);
        }
        function a() {
          requestAnimationFrame(a);
          const time = Date.now() * 0.001;
          objects.forEach((obj, index) => {
            obj.rotation.x += 0.01;
            obj.rotation.y += 0.01;
            obj.position.y = Math.sin(time + index) * 2;
          });
          renderer.render(scene, camera);
        }
        a();
        window.addEventListener("resize", () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }
    </script>
  </body>
</html>
